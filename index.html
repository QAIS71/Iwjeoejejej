<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Global Space Selfie AI - Real Human Interaction</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google AdSense Main Script -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3301550897459453"
     crossorigin="anonymous"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Inter:wght@400;700;900&display=swap');
        body { background-color: #030305; color: white; overflow-x: hidden; transition: all 0.3s ease; }
        .rtl { font-family: 'Cairo', sans-serif; direction: rtl; }
        .ltr { font-family: 'Inter', sans-serif; direction: ltr; }
        .glass { background: rgba(10, 10, 15, 0.7); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .loading-bar-inner { height: 100%; background: linear-gradient(90deg, #2563eb, #60a5fa); width: 0%; transition: width 0.1s linear; }
        .shimmer { background: linear-gradient(90deg, #111, #222, #111); background-size: 200% 100%; animation: shimmer 2s infinite; }
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
    </style>
</head>
<body class="ltr" id="appBody">

    <!-- Global Header -->
    <nav class="border-b border-white/5 bg-black/80 backdrop-blur-md sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-6 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <i data-lucide="rocket" class="text-blue-500 w-6 h-6"></i>
                <span class="font-black text-xl tracking-tight uppercase">SPACE<span class="text-blue-500">SELFIE</span></span>
            </div>

            <div class="flex items-center gap-3">
                <i data-lucide="languages" class="w-4 h-4 text-white/40"></i>
                <select id="langPicker" onchange="updateLanguage()" class="bg-white/5 text-[10px] rounded-full px-4 py-1.5 border border-white/10 outline-none cursor-pointer">
                    <option value="en">English (Default)</option>
                    <option value="ar">العربية</option>
                    <option value="zh">中文 (Chinese)</option>
                    <option value="ko">한국어 (Korean)</option>
                    <option value="ja">日本語 (Japanese)</option>
                    <option value="hi">हिन्दी (Hindi)</option>
                    <option value="es">Español</option>
                    <option value="fr">Français</option>
                    <option value="de">Deutsch</option>
                    <option value="ru">Русский</option>
                    <option value="pt">Português</option>
                    <option value="tr">Türkçe</option>
                    <option value="it">Italiano</option>
                    <option value="vi">Tiếng Việt</option>
                    <option value="th">ไทย</option>
                    <option value="id">Bahasa Indonesia</option>
                </select>
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto px-6 py-8">

        <!-- [AD SLOT 1] Header Banner - Space 1 -->
        <div class="w-full min-h-[90px] bg-white/5 border border-white/5 rounded-2xl mb-8 text-center overflow-hidden block">
             <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-3301550897459453"
             data-ad-slot="YOUR_AD_SLOT_1"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-10">

            <!-- Controls (Left) -->
            <div class="lg:col-span-5 space-y-6">
                <div class="glass p-8 rounded-[40px] shadow-2xl relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-5 pointer-events-none">
                        <i data-lucide="cpu" class="w-32 h-32"></i>
                    </div>

                    <h2 id="txt-title" class="text-3xl font-black mb-1">Realistic Space Selfie</h2>
                    <p id="txt-subtitle" class="text-white/40 text-sm mb-8">Real astronaut capturing you inside ISS</p>

                    <!-- Uploader -->
                    <div onclick="document.getElementById('imgInput').click()" class="border-2 border-dashed border-white/10 rounded-3xl p-10 bg-white/[0.02] hover:bg-white/[0.04] transition-all cursor-pointer text-center group">
                        <input type="file" id="imgInput" class="hidden" accept="image/*" onchange="handleFile(event)">
                        <div id="upload-ui">
                            <i data-lucide="camera" class="w-12 h-12 text-blue-500 mx-auto mb-4 group-hover:scale-110 transition"></i>
                            <p id="txt-upload" class="font-bold text-white/50">Click to upload your portrait</p>
                        </div>
                        <div id="preview-ui" class="hidden">
                            <img id="imgPreview" src="" class="w-24 h-24 object-cover rounded-full border-4 border-blue-500 mx-auto">
                        </div>
                    </div>

                    <!-- Region Selector -->
                    <div class="mt-8">
                        <p id="txt-region-lbl" class="text-[10px] font-black uppercase tracking-widest text-white/30 mb-4 text-center">Preferred Orbit Location</p>
                        <div id="regionGrid" class="grid grid-cols-3 gap-2"></div>
                    </div>

                    <button id="genBtn" onclick="startGeneration()" class="w-full mt-10 py-5 bg-blue-600 rounded-2xl font-black text-xl hover:bg-blue-500 transition shadow-[0_10px_30px_rgba(37,99,235,0.3)] flex items-center justify-center gap-3">
                        <i data-lucide="zap"></i>
                        <span id="txt-btn">Launch Now</span>
                    </button>

                    <p id="trustText" class="text-xs text-white/40 text-center mt-3">Images are processed and not stored.</p>
                </div>
            </div>

            <!-- Display (Right) -->
            <div class="lg:col-span-7">
                <div id="displayFrame" class="bg-[#0a0a0f] border border-white/10 rounded-[50px] aspect-square relative overflow-hidden shadow-2xl flex items-center justify-center">

                    <!-- Timer/Loading Overlay -->
                    <div id="loadingOverlay" class="hidden absolute inset-0 bg-[#050508]/95 z-30 flex flex-col items-center justify-center p-12 text-center">
                        <div class="w-full max-w-sm">
                            <div class="loader-container h-1.5 w-full bg-white/5 rounded-full mb-6 overflow-hidden">
                                <div id="pBar" class="loading-bar-inner"></div>
                            </div>
                            <h3 id="loadingText" class="text-2xl font-black mb-2 italic">Transmitting data to orbit...</h3>
                            <p class="text-blue-400 text-xs font-bold" id="timerCount">20s Remaining</p>
                        </div>
                    </div>

                    <div id="emptyView" class="text-center opacity-10">
                        <i data-lucide="milestone" class="w-24 h-24 mx-auto mb-4"></i>
                        <p class="text-[10px] font-black tracking-[1em] uppercase">No Signal Detected</p>
                    </div>

                    <div id="resultView" class="hidden w-full h-full relative group">
                        <img id="finalImg" src="" class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-gradient-to-t from-black p-10 flex flex-col justify-end opacity-0 group-hover:opacity-100 transition-all">
                            <button onclick="downloadImage()" class="w-full py-5 bg-white text-black font-black rounded-2xl flex items-center justify-center gap-3 hover:scale-[1.02] transition">
                                <i data-lucide="download"></i> <span id="txt-dl">Download 8K Image</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- [AD SLOT 2] Bottom Banner - Space 2 -->
                <div class="mt-8 bg-white/5 min-h-[100px] rounded-2xl border border-white/5 text-center overflow-hidden block">
                    <ins class="adsbygoogle"
                    style="display:block"
                    data-ad-client="ca-pub-3301550897459453"
                    data-ad-slot="YOUR_AD_SLOT_2"
                    data-ad-format="auto"
                    data-full-width-responsive="true"></ins>
                   <script>
                       (adsbygoogle = window.adsbygoogle || []).push({});
                   </script>
                </div>
            </div>

        </div>
    </main>

    <footer class="py-12 border-t border-white/5 opacity-20 text-center text-[10px] font-bold tracking-[0.5em] mt-10">
        © 2024 SPACESELFIE GLOBAL SYSTEM
    </footer>

    <script>
        let currentLang = 'en';
        let currentRegion = 0;
        let userImageBase64 = null;
        let userImageMimeType = null;

        const languages = {
            en: { title: "Realistic Space Selfie", sub: "Real astronaut capturing you inside ISS", upload: "Click to upload your portrait", btn: "Launch Now", regions: ["Middle East", "Europe", "Africa", "Asia", "Americas"], dl: "Download 8K Image", loading: ["Analyzing face...", "Preparing space suit...", "Adjusting orbit light...", "Capturing final shot..."], transmission: "Transmitting data to orbit...", remaining: "Remaining" },
            ar: { title: "سيلفي الفضاء الواقعي", sub: "رائد فضاء حقيقي يصورك داخل محطة ISS", upload: "اضغط لرفع صورتك الشخصية", btn: "إقلاع الآن", regions: ["الشرق الأوسط", "أوروبا", "أفريقيا", "آسيا", "الأمريكتين"], dl: "تحميل الصورة 8K", loading: ["تحليل الوجه...", "تجهيز بدلة الفضاء...", "ضبط إضاءة المدار...", "التقاط الصورة النهائية..."], transmission: "جاري إرسال البيانات للمدار...", remaining: "متبقي" }
        };

        function updateLanguage() {
            currentLang = document.getElementById('langPicker').value;
            const t = languages[currentLang] || languages['en'];

            document.getElementById('txt-title').innerText = t.title;
            document.getElementById('txt-subtitle').innerText = t.sub;
            document.getElementById('txt-upload').innerText = t.upload;
            document.getElementById('txt-btn').innerText = t.btn;
            document.getElementById('txt-dl').innerText = t.dl;
            document.getElementById('txt-region-lbl').innerText = (currentLang === 'ar' ? "الموقع المداري المفضل" : "Preferred Orbit Location");

            document.getElementById('appBody').className = (currentLang === 'ar') ? 'rtl' : 'ltr';
            renderRegions();
        }

        function renderRegions() {
            const t = languages[currentLang] || languages['en'];
            const grid = document.getElementById('regionGrid');
            grid.innerHTML = '';
            t.regions.forEach((name, i) => {
                const b = document.createElement('button');
                b.className = `py-2 rounded-xl text-[10px] font-bold border transition-all ${currentRegion === i ? 'bg-blue-600 border-blue-400' : 'bg-white/5 border-white/10 text-white/40'}`;
                b.innerText = name;
                b.onclick = () => { currentRegion = i; renderRegions(); };
                grid.appendChild(b);
            });
        }

        function handleFile(e) {
            const file = e.target.files[0];
            if(file) {
                userImageMimeType = file.type;
                const reader = new FileReader();
                reader.onload = (ev) => {
                    document.getElementById('imgPreview').src = ev.target.result;
                    document.getElementById('preview-ui').classList.remove('hidden');
                    document.getElementById('upload-ui').classList.add('hidden');
                    userImageBase64 = ev.target.result.split(',')[1];
                };
                reader.readAsDataURL(file);
            }
        }

        async function startGeneration() {
            if(!userImageBase64) return alert(currentLang === 'ar' ? "الرجاء رفع صورة أولاً!" : "Upload photo first!");
            const overlay = document.getElementById('loadingOverlay');
            overlay.classList.remove('hidden');
            let timeLeft = 20;
            let progress = 0;
            const t = languages[currentLang] || languages['en'];

            const interval = setInterval(() => {
                timeLeft -= 0.1;
                progress += 0.5;
                document.getElementById('pBar').style.width = `${Math.min(progress, 100)}%`;
                document.getElementById('timerCount').innerText = `${Math.ceil(timeLeft)}s ${t.remaining}`;

                if(timeLeft <= 0) {
                    clearInterval(interval);
                    callBackendGenerate();
                }
            }, 100);
        }

        async function callBackendGenerate() {
            const overlay = document.getElementById('loadingOverlay');
            const t = languages[currentLang] || languages['en'];
            const region = (languages[currentLang] || languages['en']).regions[currentRegion] || 'Earth';

            try {
                const res = await fetch('/.netlify/functions/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        imageBase64: userImageBase64,
                        imageMimeType: userImageMimeType || 'image/png',
                        region,
                        lang: currentLang
                    })
                });

                const data = await res.json();

                if (!res.ok) {
                    console.error('Backend error', data);
                    alert((currentLang === 'ar' ? 'حدث خطأ في الخادم: ' : 'Server error: ') + (data?.error || res.statusText));
                    return;
                }

                if (!data?.imageBase64) {
                    console.error('No image returned', data);
                    alert(currentLang === 'ar' ? 'لم يتم توليد صورة.' : 'No image generated.');
                    return;
                }

                document.getElementById('finalImg').src = `data:${data.mimeType || 'image/png'};base64,${data.imageBase64}`;
                document.getElementById('resultView').classList.remove('hidden');
                document.getElementById('emptyView').classList.add('hidden');

            } catch (err) {
                console.error('Request failed', err);
                alert(currentLang === 'ar' ? 'فشل الاتصال بالخادم.' : 'Failed to contact server.');
            } finally {
                overlay.classList.add('hidden');
            }
        }

        function downloadImage() {
            const a = document.createElement('a');
            a.href = document.getElementById('finalImg').src;
            a.download = 'ISS_Space_Selfie_Global.png';
            a.click();
        }

        updateLanguage();
        lucide.createIcons();
    </script>
</body>
</html>
