<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Space Selfie AI - Real Human Interaction</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Inter:wght@400;700;900&display=swap');
        body { background-color: #030305; color: white; overflow-x: hidden; transition: all 0.3s ease; }
        .rtl { font-family: 'Cairo', sans-serif; direction: rtl; }
        .ltr { font-family: 'Inter', sans-serif; direction: ltr; }
        .glass { background: rgba(10, 10, 15, 0.7); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .loading-bar-inner { height: 100%; background: linear-gradient(90deg, #2563eb, #60a5fa); width: 0%; transition: width 0.1s linear; }
        .shimmer { background: linear-gradient(90deg, #111, #222, #111); background-size: 200% 100%; animation: shimmer 2s infinite; }
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
    </style>
</head>
<body class="ltr" id="appBody">

    <!-- Global Header -->
    <nav class="border-b border-white/5 bg-black/80 backdrop-blur-md sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-6 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <i data-lucide="rocket" class="text-blue-500 w-6 h-6"></i>
                <span class="font-black text-xl tracking-tight uppercase">SPACE<span class="text-blue-500">SELFIE</span></span>
            </div>
            
            <div class="flex items-center gap-3">
                <i data-lucide="languages" class="w-4 h-4 text-white/40"></i>
                <select id="langPicker" onchange="updateLanguage()" class="bg-white/5 text-[10px] rounded-full px-4 py-1.5 border border-white/10 outline-none cursor-pointer">
                    <option value="en">English (Default)</option>
                    <option value="ar">العربية</option>
                    <option value="zh">中文 (Chinese)</option>
                    <option value="ko">한국어 (Korean)</option>
                    <option value="ja">日本語 (Japanese)</option>
                    <option value="hi">हिन्दी (Hindi)</option>
                    <option value="es">Español</option>
                    <option value="fr">Français</option>
                    <option value="de">Deutsch</option>
                    <option value="ru">Русский</option>
                    <option value="pt">Português</option>
                    <option value="tr">Türkçe</option>
                    <option value="it">Italiano</option>
                    <option value="vi">Tiếng Việt</option>
                    <option value="th">ไทย</option>
                    <option value="id">Bahasa Indonesia</option>
                </select>
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto px-6 py-8">
        
        <!-- Header Ad Slot -->
        <div class="w-full h-24 bg-white/5 border border-white/5 rounded-2xl mb-8 flex items-center justify-center text-[10px] text-white/20 tracking-[1em] shimmer">
            LEADERBOARD AD SPACE (728x90)
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-10">
            
            <!-- Controls (Left) -->
            <div class="lg:col-span-5 space-y-6">
                <div class="glass p-8 rounded-[40px] shadow-2xl relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-5 pointer-events-none">
                        <i data-lucide="cpu" class="w-32 h-32"></i>
                    </div>

                    <h2 id="txt-title" class="text-3xl font-black mb-1">Realistic Space Selfie</h2>
                    <p id="txt-subtitle" class="text-white/40 text-sm mb-8">Real astronaut capturing you inside ISS</p>

                    <!-- Uploader -->
                    <div onclick="document.getElementById('imgInput').click()" class="border-2 border-dashed border-white/10 rounded-3xl p-10 bg-white/[0.02] hover:bg-white/[0.04] transition-all cursor-pointer text-center group">
                        <input type="file" id="imgInput" class="hidden" accept="image/*" onchange="handleFile(event)">
                        <div id="upload-ui">
                            <i data-lucide="camera" class="w-12 h-12 text-blue-500 mx-auto mb-4 group-hover:scale-110 transition"></i>
                            <p id="txt-upload" class="font-bold text-white/50">Click to upload your portrait</p>
                        </div>
                        <div id="preview-ui" class="hidden">
                            <img id="imgPreview" src="" class="w-24 h-24 object-cover rounded-full border-4 border-blue-500 mx-auto">
                        </div>
                    </div>

                    <!-- Region Selector -->
                    <div class="mt-8">
                        <p id="txt-region-lbl" class="text-[10px] font-black uppercase tracking-widest text-white/30 mb-4 text-center">Preferred Orbit Location</p>
                        <div id="regionGrid" class="grid grid-cols-3 gap-2"></div>
                    </div>

                    <button id="genBtn" onclick="startGeneration()" class="w-full mt-10 py-5 bg-blue-600 rounded-2xl font-black text-xl hover:bg-blue-500 transition shadow-[0_10px_30px_rgba(37,99,235,0.3)] flex items-center justify-center gap-3">
                        <i data-lucide="zap"></i>
                        <span id="txt-btn">Launch Now</span>
                    </button>
                </div>

                <div class="bg-white/5 p-4 rounded-2xl border border-white/10 text-center">
                    <p class="text-[9px] text-white/30 uppercase tracking-widest mb-2">Sponsored Content</p>
                    <div class="h-48 bg-black/50 rounded-xl flex items-center justify-center text-[10px] text-white/10">
                        NATIVE AD SLOT (300x250)
                    </div>
                </div>
            </div>

            <!-- Display (Right) -->
            <div class="lg:col-span-7">
                <div id="displayFrame" class="bg-[#0a0a0f] border border-white/10 rounded-[50px] aspect-square relative overflow-hidden shadow-2xl flex items-center justify-center">
                    
                    <!-- Timer/Loading Overlay -->
                    <div id="loadingOverlay" class="hidden absolute inset-0 bg-[#050508]/95 z-30 flex flex-col items-center justify-center p-12 text-center">
                        <div class="w-full max-w-sm">
                            <div class="loader-container h-1.5 w-full bg-white/5 rounded-full mb-6 overflow-hidden">
                                <div id="pBar" class="loading-bar-inner"></div>
                            </div>
                            <h3 id="loadingText" class="text-2xl font-black mb-2 italic">Transmitting data to orbit...</h3>
                            <p class="text-blue-400 text-xs font-bold" id="timerCount">20s Remaining</p>
                        </div>
                        <div class="mt-12 w-full h-40 bg-white/5 border border-white/5 rounded-2xl flex items-center justify-center text-[8px] text-white/10">
                            IN-PROCESS AD SPACE
                        </div>
                    </div>

                    <div id="emptyView" class="text-center opacity-10">
                        <i data-lucide="milestone" class="w-24 h-24 mx-auto mb-4"></i>
                        <p class="text-[10px] font-black tracking-[1em] uppercase">No Signal Detected</p>
                    </div>

                    <div id="resultView" class="hidden w-full h-full relative group">
                        <img id="finalImg" src="" class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-gradient-to-t from-black p-10 flex flex-col justify-end opacity-0 group-hover:opacity-100 transition-all">
                            
                            <div class="mb-6 h-16 bg-white/10 rounded-xl border border-white/10 flex items-center justify-center text-[8px] text-white/40 uppercase">
                                Pre-Download Ad Space
                            </div>

                            <button onclick="downloadImage()" class="w-full py-5 bg-white text-black font-black rounded-2xl flex items-center justify-center gap-3 hover:scale-[1.02] transition">
                                <i data-lucide="download"></i> <span id="txt-dl">Download 8K Image</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="mt-8 flex gap-4">
                    <div class="flex-1 bg-white/5 h-20 rounded-2xl border border-white/5 flex items-center justify-center text-[9px] text-white/20">FOOTER AD 1</div>
                    <div class="flex-1 bg-white/5 h-20 rounded-2xl border border-white/5 flex items-center justify-center text-[9px] text-white/20">FOOTER AD 2</div>
                </div>
            </div>

        </div>
    </main>

    <footer class="py-12 border-t border-white/5 opacity-20 text-center text-[10px] font-bold tracking-[0.5em] mt-10">
        © 2024 SPACESELFIE GLOBAL SYSTEM
    </footer>

    <script>
        const API_KEY = "AIzaSyApbpPAAw5IwUca4KMKVa6HaVA0iHCD16Y"; // System will inject the key automatically
        let currentLang = 'en'; 
        let currentRegion = 0;
        let userImageBase64 = null;
        let userImageMimeType = null; // Variable to store the correct mime type

        const languages = {
            en: { title: "Realistic Space Selfie", sub: "Real astronaut capturing you inside ISS", upload: "Click to upload your portrait", btn: "Launch Now", regions: ["Middle East", "Europe", "Africa", "Asia", "Americas"], dl: "Download 8K Image", loading: ["Analyzing face...", "Preparing space suit...", "Adjusting orbit light...", "Capturing final shot..."], transmission: "Transmitting data to orbit...", remaining: "Remaining" },
            ar: { title: "سيلفي الفضاء الواقعي", sub: "رائد فضاء حقيقي يصورك داخل محطة ISS", upload: "اضغط لرفع صورتك الشخصية", btn: "إقلاع الآن", regions: ["الشرق الأوسط", "أوروبا", "أفريقيا", "آسيا", "الأمريكتين"], dl: "تحميل الصورة 8K", loading: ["تحليل الوجه...", "تجهيز بدلة الفضاء...", "ضبط إضاءة المدار...", "التقاط الصورة النهائية..."], transmission: "جاري إرسال البيانات للمدار...", remaining: "متبقي" },
            zh: { title: "写实太空自拍", sub: "宇航员在国际空间站为您拍照", upload: "点击上传照片", btn: "立即转换", regions: ["中东", "欧洲", "非洲", "亚洲", "美洲"], dl: "下载 8K 图片", loading: ["分析面部...", "准备宇航服...", "调整轨道光线...", "拍摄最终样张..."], transmission: "数据传输至轨道...", remaining: "剩余" },
            ko: { title: "사실적인 우주 셀카", sub: "ISS 내부의 100% 사실적인 시뮬레이션", upload: "사진 업로드", btn: "지금 발사", loading: ["체हरा विश्लेषण...", "सूट तैयार करना...", "लाइटिंग सेट करना...", "फोटो खींचنا..."], regions: ["중동", "유럽", "아프리카", "아시아", "아메리카"], dl: "8K 이미지 다운로드", transmission: "궤도로 데이터 전송 중...", remaining: "남음" }
        };

        function updateLanguage() {
            currentLang = document.getElementById('langPicker').value;
            const t = languages[currentLang] || languages['en'];
            
            document.getElementById('txt-title').innerText = t.title;
            document.getElementById('txt-subtitle').innerText = t.sub;
            document.getElementById('txt-upload').innerText = t.upload;
            document.getElementById('txt-btn').innerText = t.btn;
            document.getElementById('txt-dl').innerText = t.dl;
            document.getElementById('txt-region-lbl').innerText = t.regions_label || (currentLang === 'ar' ? "الموقع المداري المفضل" : "Preferred Orbit Location");
            
            document.getElementById('appBody').className = (currentLang === 'ar') ? 'rtl' : 'ltr';
            renderRegions();
        }

        function renderRegions() {
            const t = languages[currentLang] || languages['en'];
            const grid = document.getElementById('regionGrid');
            grid.innerHTML = '';
            t.regions.forEach((name, i) => {
                const b = document.createElement('button');
                b.className = `py-2 rounded-xl text-[10px] font-bold border transition-all ${currentRegion === i ? 'bg-blue-600 border-blue-400' : 'bg-white/5 border-white/10 text-white/40'}`;
                b.innerText = name;
                b.onclick = () => { currentRegion = i; renderRegions(); };
                grid.appendChild(b);
            });
        }

        function handleFile(e) {
            const file = e.target.files[0];
            if(file) {
                userImageMimeType = file.type; // Save the mime type
                const reader = new FileReader();
                reader.onload = (ev) => {
                    document.getElementById('imgPreview').src = ev.target.result;
                    document.getElementById('preview-ui').classList.remove('hidden');
                    document.getElementById('upload-ui').classList.add('hidden');
                    userImageBase64 = ev.target.result.split(',')[1];
                };
                reader.readAsDataURL(file);
            }
        }

        async function startGeneration() {
            if(!userImageBase64) return alert(currentLang === 'ar' ? "الرجاء رفع صورة أولاً!" : "Upload photo first!");
            
            const overlay = document.getElementById('loadingOverlay');
            const pBar = document.getElementById('pBar');
            const timerTxt = document.getElementById('timerCount');
            const statusTxt = document.getElementById('loadingText');
            
            overlay.classList.remove('hidden');
            let timeLeft = 20; // 20 Seconds waiting simulation
            let progress = 0;
            const t = languages[currentLang] || languages['en'];

            const interval = setInterval(() => {
                timeLeft -= 0.1;
                progress += (100 / 200);
                pBar.style.width = `${progress}%`;
                timerTxt.innerText = `${Math.ceil(timeLeft)}s ${t.remaining}`;
                
                if(progress > 75) statusTxt.innerText = t.loading[3];
                else if(progress > 50) statusTxt.innerText = t.loading[2];
                else if(progress > 25) statusTxt.innerText = t.loading[1];
                else statusTxt.innerText = t.loading[0];

                if(timeLeft <= 0) {
                    clearInterval(interval);
                    executeAI();
                }
            }, 100);
        }

        async function executeAI() {
            const t = languages[currentLang] || languages['en'];
            const region = t.regions[currentRegion];
            
            const prompt = `A hyper-realistic 8K first-person perspective or close-up inside the ISS Cupola module. A real astronaut in a detailed white space suit is visible, his hands are holding up a professional tablet or a physical high-res photograph showing the face from this image. The astronaut's gloved hand is clearly visible, making it look 100% real and tangible. The background through the glass shows a breathtaking Earth over ${region}. Natural cinematic lighting, space station interior details, zero AI artifacts, looks like a real memory captured in orbit.`;

            try {
                // IMPORTANT: Using 'gemini-2.5-flash-image-preview' for image editing/generation
                // Using dynamic MIME type instead of hardcoded 'image/png'
               const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                { text: prompt }, 
                                { inlineData: { mimeType: userImageMimeType || "image/png", data: userImageBase64 } }
                            ]
                        }],
                        generationConfig: { responseModalities: ['TEXT', 'IMAGE'] }
                    })
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status} ${response.statusText}`);
                }

                const data = await response.json();
                
                // Debugging: Log full response to see safety ratings
                console.log("Full API Response:", data);

                // Check for safety finish reason
                const candidate = data.candidates?.[0];
                if (candidate?.finishReason === 'SAFETY') {
                     throw new Error(currentLang === 'ar' ? "تم حظر الصورة بواسطة فلاتر الأمان. الرجاء تجربة صورة مختلفة." : "Image blocked by safety filters. Please try a different photo.");
                }

                // Check if we have a valid image candidate
                const img = candidate?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

                if(img) {
                    document.getElementById('finalImg').src = `data:image/png;base64,${img}`;
                    document.getElementById('resultView').classList.remove('hidden');
                    document.getElementById('emptyView').classList.add('hidden');
                } else {
                    throw new Error("No image generated. Finish Reason: " + (candidate?.finishReason || "Unknown"));
                }

            } catch(e) {
                console.error(e);
                alert(e.message || (currentLang === 'ar' ? "حدث خطأ أثناء المعالجة." : "Error processing image."));
            } finally {
                document.getElementById('loadingOverlay').classList.add('hidden');
            }
        }

        function downloadImage() {
            const a = document.createElement('a');
            a.href = document.getElementById('finalImg').src;
            a.download = 'ISS_Space_Selfie_Global.png';
            a.click();
        }

        updateLanguage();
        lucide.createIcons();
    </script>
</body>
</html>

